import BigInt
import Eth
import Foundation

enum Structs {
    struct Bat: Equatable {
        static let schema: ABI.Schema = .tuple([.uint96, .uint160, .array(Cat.schema), .string, .array(.uint256), Cat.schema])

        let a: BigUInt
        let b: BigUInt
        let c: [Cat]
        let d: String
        let e: [BigUInt]
        let f: Cat

        var encoded: Hex {
            asValue.encoded
        }

        var asValue: ABI.Value {
            .tuple6(.uint96(a),
                    .uint160(b),
                    .array(Cat.schema, c.map {
                        $0.asValue
                    }),
                    .string(d),
                    .array(.uint256, e.map {
                        .uint256($0)
                    }),
                    f.asValue)
        }

        static func decode(hex: Hex) throws -> Bat {
            if let value = try? schema.decode(hex) {
                return try decodeValue(value)
            }
            // both versions are valid encodings of tuples with dynamic fields ( bytes or string ), so try both decodings
            if case let .tuple1(wrappedValue) = try? ABI.Schema.tuple([schema]).decode(hex) {
                return try decodeValue(wrappedValue)
            }
            // retry original to throw the error
            return try decodeValue(schema.decode(hex))
        }

        static func decodeValue(_ value: ABI.Value) throws -> Bat {
            switch value {
            case let .tuple6(.uint96(a),
                             .uint160(b),
                             .array(Cat.schema, c),
                             .string(d),
                             .array(.uint256, e),
                             f):
                return try Bat(a: a, b: b, c: c.map {
                    try Cat.decodeValue($0)
                }, d: d, e: e.map {
                    $0.asBigUInt!
                }, f: Cat.decodeValue(f))
            default:
                throw ABI.DecodeError.mismatchedType(value.schema, schema)
            }
        }
    }

    struct Cat: Equatable {
        static let schema: ABI.Schema = .tuple([.int256, .bytes, .bytes32])

        let ca: BigInt
        let cb: Hex
        let cc: Hex

        var encoded: Hex {
            asValue.encoded
        }

        var asValue: ABI.Value {
            .tuple3(.int256(ca),
                    .bytes(cb),
                    .bytes32(cc))
        }

        static func decode(hex: Hex) throws -> Cat {
            if let value = try? schema.decode(hex) {
                return try decodeValue(value)
            }
            // both versions are valid encodings of tuples with dynamic fields ( bytes or string ), so try both decodings
            if case let .tuple1(wrappedValue) = try? ABI.Schema.tuple([schema]).decode(hex) {
                return try decodeValue(wrappedValue)
            }
            // retry original to throw the error
            return try decodeValue(schema.decode(hex))
        }

        static func decodeValue(_ value: ABI.Value) throws -> Cat {
            switch value {
            case let .tuple3(.int256(ca),
                             .bytes(cb),
                             .bytes32(cc)):
                return Cat(ca: ca, cb: cb, cc: cc)
            default:
                throw ABI.DecodeError.mismatchedType(value.schema, schema)
            }
        }
    }

    enum Animal {
        struct Goose: Equatable {
            static let schema: ABI.Schema = .tuple([.uint256, .string])

            let b: BigUInt
            let c: String

            var encoded: Hex {
                asValue.encoded
            }

            var asValue: ABI.Value {
                .tuple2(.uint256(b),
                        .string(c))
            }

            static func decode(hex: Hex) throws -> Animal.Goose {
                if let value = try? schema.decode(hex) {
                    return try decodeValue(value)
                }
                // both versions are valid encodings of tuples with dynamic fields ( bytes or string ), so try both decodings
                if case let .tuple1(wrappedValue) = try? ABI.Schema.tuple([schema]).decode(hex) {
                    return try decodeValue(wrappedValue)
                }
                // retry original to throw the error
                return try decodeValue(schema.decode(hex))
            }

            static func decodeValue(_ value: ABI.Value) throws -> Animal.Goose {
                switch value {
                case let .tuple2(.uint256(b),
                                 .string(c)):
                    return Animal.Goose(b: b, c: c)
                default:
                    throw ABI.DecodeError.mismatchedType(value.schema, schema)
                }
            }
        }

        struct Moose: Equatable {
            static let schema: ABI.Schema = .tuple([.uint256])

            let b: BigUInt

            var encoded: Hex {
                asValue.encoded
            }

            var asValue: ABI.Value {
                .tuple1(.uint256(b))
            }

            static func decode(hex: Hex) throws -> Animal.Moose {
                if let value = try? schema.decode(hex) {
                    return try decodeValue(value)
                }
                // both versions are valid encodings of tuples with dynamic fields ( bytes or string ), so try both decodings
                if case let .tuple1(wrappedValue) = try? ABI.Schema.tuple([schema]).decode(hex) {
                    return try decodeValue(wrappedValue)
                }
                // retry original to throw the error
                return try decodeValue(schema.decode(hex))
            }

            static func decodeValue(_ value: ABI.Value) throws -> Animal.Moose {
                switch value {
                case let .tuple1(.uint256(b)):
                    return Animal.Moose(b: b)
                default:
                    throw ABI.DecodeError.mismatchedType(value.schema, schema)
                }
            }
        }

        struct Rat: Equatable {
            static let schema: ABI.Schema = .tuple([.address])

            let a: EthAddress

            var encoded: Hex {
                asValue.encoded
            }

            var asValue: ABI.Value {
                .tuple1(.address(a))
            }

            static func decode(hex: Hex) throws -> Animal.Rat {
                if let value = try? schema.decode(hex) {
                    return try decodeValue(value)
                }
                // both versions are valid encodings of tuples with dynamic fields ( bytes or string ), so try both decodings
                if case let .tuple1(wrappedValue) = try? ABI.Schema.tuple([schema]).decode(hex) {
                    return try decodeValue(wrappedValue)
                }
                // retry original to throw the error
                return try decodeValue(schema.decode(hex))
            }

            static func decodeValue(_ value: ABI.Value) throws -> Animal.Rat {
                switch value {
                case let .tuple1(.address(a)):
                    return Animal.Rat(a: a)
                default:
                    throw ABI.DecodeError.mismatchedType(value.schema, schema)
                }
            }
        }
    }

    static let creationCode: Hex = "0x608060405234801561001057600080fd5b50610fe3806100206000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c8063314ded701461006757806358b15a54146100855780636fe03f99146100a8578063ac8dd3a4146100c8578063d7a69d4f146100dd578063eedfb21e14610108575b600080fd5b61006f610129565b60405161007c9190610685565b60405180910390f35b61009861009336600461074b565b6101ae565b604051901515815260200161007c565b6100bb6100b6366004610800565b6101fd565b60405161007c9190610891565b6100d0610489565b60405161007c919061097d565b6100f06100eb3660046109c2565b61053f565b6040516001600160a01b03909116815260200161007c565b61011b610116366004610ca2565b610593565b60405190815260200161007c565b60408051600180825281830190925260609160009190816020015b6040805180820190915260008152606060208201528152602001906001900390816101445790505090508060008151811061018157610181610d9c565b6020026020010151604051602001610199919061097d565b60405160208183030381529060405291505090565b6000805b83518110156101f157828482815181106101ce576101ce610d9c565b602002602001015160000151036101e95760019150506101f7565b6001016101b2565b50600090505b92915050565b6102476040805160c081018252600080825260208083018290526060838501819052808401819052608084018190528451808201865283815291820152928301529060a082015290565b6000826001600160401b0381111561026157610261610698565b6040519080825280602002602001820160405280156102b957816020015b6102a660405180606001604052806000815260200160608152602001600080191681525090565b81526020019060019003908161027f5790505b50905060005b83811015610372576040518060600160405280826102dc90610dc8565b8152602001826001600160401b038111156102f9576102f9610698565b6040519080825280601f01601f191660200182016040528015610323576020820181803683370190505b5081526020017f112233445566778899112233445566778899112233445566778899112233445581525082828151811061035f5761035f610d9c565b60209081029190910101526001016102bf565b506000836001600160401b0381111561038d5761038d610698565b6040519080825280602002602001820160405280156103b6578160200160208202803683370190505b50905060005b848110156103f3576103ce8180610ec8565b8282815181106103e0576103e0610d9c565b60209081029190910101526001016103bc565b506040518060c00160405280866001600160601b0316815260200160018761041b9190610ed4565b6001600160601b03166001600160a01b031681526020018381526020016040518060400160405280600581526020016468656c6c6f60d81b81525081526020018281526020018360008151811061047457610474610d9c565b60200260200101518152509250505092915050565b604080518082018252600080825260606020830152825160018082528185019094529192909190816020015b6040805180820190915260008152606060208201528152602001906001900390816104b5579050509050604051806040016040528060048152602001635553444360e01b8152508160008151811061050f5761050f610d9c565b6020026020010151602001819052508060008151811061053157610531610d9c565b602002602001015191505090565b6000805b82518110156101f15783600001516001600160a01b031683828151811061056c5761056c610d9c565b60200260200101516001600160a01b03160361058b57505081516101f7565b600101610543565b600080826020015183600001516001600160601b03166105b39190610ee7565b60130b905060005b83604001515181101561062b57836040015181815181106105de576105de610d9c565b6020026020010151600001518460400151828151811061060057610600610d9c565b602002602001015160200151516106179190610f19565b6106219083610f49565b91506001016105bb565b5061063860011982610f71565b9392505050565b6000815180845260005b8181101561066557602081850181015186830182015201610649565b506000602082860101526020601f19601f83011685010191505092915050565b602081526000610638602083018461063f565b634e487b7160e01b600052604160045260246000fd5b604051602081016001600160401b03811182821017156106d0576106d0610698565b60405290565b60405160c081016001600160401b03811182821017156106d0576106d0610698565b604051601f8201601f191681016001600160401b038111828210171561072057610720610698565b604052919050565b60006001600160401b0382111561074157610741610698565b5060051b60200190565b6000806040838503121561075e57600080fd5b82356001600160401b0381111561077457600080fd5b8301601f8101851361078557600080fd5b8035602061079a61079583610728565b6106f8565b82815260059290921b830181019181810190888411156107b957600080fd5b938201935b838510156107f15782858a0312156107d65760008081fd5b6107de6106ae565b85358152825293820193908201906107be565b98969091013596505050505050565b6000806040838503121561081357600080fd5b50508035926020909101359150565b805182526000602082015160606020850152610841606085018261063f565b604093840151949093019390935250919050565b60008151808452602080850194506020840160005b838110156108865781518752958201959082019060010161086a565b509495945050505050565b602080825282516001600160601b031682820152828101516001600160a01b031660408084019190915283015160c06060840152805160e0840181905260009291610100600583901b86018101929184019190860190855b818110156109175760ff19888603018352610905858551610822565b945092850192918501916001016108e9565b5050505060608501519150601f1980858303016080860152610939828461063f565b925060808601519150808584030160a08601526109568383610855565b925060a08601519150808584030160c0860152506109748282610822565b95945050505050565b6020815281516020820152600060208301516040808401526109a2606084018261063f565b949350505050565b6001600160a01b03811681146109bf57600080fd5b50565b60008082840360408112156109d657600080fd5b6020808212156109e557600080fd5b6109ed6106ae565b915084356109fa816109aa565b825290925083810135906001600160401b03821115610a1857600080fd5b818501915085601f830112610a2c57600080fd5b8135610a3a61079582610728565b81815260059190911b83018201908281019088831115610a5957600080fd5b938301935b82851015610a80578435610a71816109aa565b82529383019390830190610a5e565b80955050505050509250929050565b80356001600160601b0381168114610aa657600080fd5b919050565b8035610aa6816109aa565b60006001600160401b03831115610acf57610acf610698565b610ae2601f8401601f19166020016106f8565b9050828152838383011115610af657600080fd5b828260208301376000602084830101529392505050565b600060608284031215610b1f57600080fd5b604051606081016001600160401b038282108183111715610b4257610b42610698565b81604052829350843583526020850135915080821115610b6157600080fd5b508301601f81018513610b7357600080fd5b610b8285823560208401610ab6565b602083015250604083013560408201525092915050565b600082601f830112610baa57600080fd5b81356020610bba61079583610728565b82815260059290921b84018101918181019086841115610bd957600080fd5b8286015b84811015610c185780356001600160401b03811115610bfc5760008081fd5b610c0a8986838b0101610b0d565b845250918301918301610bdd565b509695505050505050565b600082601f830112610c3457600080fd5b61063883833560208501610ab6565b600082601f830112610c5457600080fd5b81356020610c6461079583610728565b8083825260208201915060208460051b870101935086841115610c8657600080fd5b602086015b84811015610c185780358352918301918301610c8b565b600060208284031215610cb457600080fd5b81356001600160401b0380821115610ccb57600080fd5b9083019060c08286031215610cdf57600080fd5b610ce76106d6565b610cf083610a8f565b8152610cfe60208401610aab565b6020820152604083013582811115610d1557600080fd5b610d2187828601610b99565b604083015250606083013582811115610d3957600080fd5b610d4587828601610c23565b606083015250608083013582811115610d5d57600080fd5b610d6987828601610c43565b60808301525060a083013582811115610d8157600080fd5b610d8d87828601610b0d565b60a08301525095945050505050565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b6000600160ff1b8201610ddd57610ddd610db2565b5060000390565b600181815b80851115610e1f578160001904821115610e0557610e05610db2565b80851615610e1257918102915b93841c9390800290610de9565b509250929050565b600082610e36575060016101f7565b81610e43575060006101f7565b8160018114610e595760028114610e6357610e7f565b60019150506101f7565b60ff841115610e7457610e74610db2565b50506001821b6101f7565b5060208310610133831016604e8410600b8410161715610ea2575081810a6101f7565b610eac8383610de4565b8060001904821115610ec057610ec0610db2565b029392505050565b60006106388383610e27565b818103818111156101f7576101f7610db2565b6001600160a01b03828116828216818102831692918115828504821417610f1057610f10610db2565b50505092915050565b80820260008212600160ff1b84141615610f3557610f35610db2565b81810583148215176101f7576101f7610db2565b8082018281126000831280158216821582161715610f6957610f69610db2565b505092915050565b600082610f8e57634e487b7160e01b600052601260045260246000fd5b600160ff1b821460001984141615610fa857610fa8610db2565b50059056fea264697066735822122070b4e453579dddf0a61d86af981f2027624975b823d2a690cb3bc837d522e76664736f6c63430008180033"
    static let runtimeCode: Hex = "0x608060405234801561001057600080fd5b50600436106100625760003560e01c8063314ded701461006757806358b15a54146100855780636fe03f99146100a8578063ac8dd3a4146100c8578063d7a69d4f146100dd578063eedfb21e14610108575b600080fd5b61006f610129565b60405161007c9190610685565b60405180910390f35b61009861009336600461074b565b6101ae565b604051901515815260200161007c565b6100bb6100b6366004610800565b6101fd565b60405161007c9190610891565b6100d0610489565b60405161007c919061097d565b6100f06100eb3660046109c2565b61053f565b6040516001600160a01b03909116815260200161007c565b61011b610116366004610ca2565b610593565b60405190815260200161007c565b60408051600180825281830190925260609160009190816020015b6040805180820190915260008152606060208201528152602001906001900390816101445790505090508060008151811061018157610181610d9c565b6020026020010151604051602001610199919061097d565b60405160208183030381529060405291505090565b6000805b83518110156101f157828482815181106101ce576101ce610d9c565b602002602001015160000151036101e95760019150506101f7565b6001016101b2565b50600090505b92915050565b6102476040805160c081018252600080825260208083018290526060838501819052808401819052608084018190528451808201865283815291820152928301529060a082015290565b6000826001600160401b0381111561026157610261610698565b6040519080825280602002602001820160405280156102b957816020015b6102a660405180606001604052806000815260200160608152602001600080191681525090565b81526020019060019003908161027f5790505b50905060005b83811015610372576040518060600160405280826102dc90610dc8565b8152602001826001600160401b038111156102f9576102f9610698565b6040519080825280601f01601f191660200182016040528015610323576020820181803683370190505b5081526020017f112233445566778899112233445566778899112233445566778899112233445581525082828151811061035f5761035f610d9c565b60209081029190910101526001016102bf565b506000836001600160401b0381111561038d5761038d610698565b6040519080825280602002602001820160405280156103b6578160200160208202803683370190505b50905060005b848110156103f3576103ce8180610ec8565b8282815181106103e0576103e0610d9c565b60209081029190910101526001016103bc565b506040518060c00160405280866001600160601b0316815260200160018761041b9190610ed4565b6001600160601b03166001600160a01b031681526020018381526020016040518060400160405280600581526020016468656c6c6f60d81b81525081526020018281526020018360008151811061047457610474610d9c565b60200260200101518152509250505092915050565b604080518082018252600080825260606020830152825160018082528185019094529192909190816020015b6040805180820190915260008152606060208201528152602001906001900390816104b5579050509050604051806040016040528060048152602001635553444360e01b8152508160008151811061050f5761050f610d9c565b6020026020010151602001819052508060008151811061053157610531610d9c565b602002602001015191505090565b6000805b82518110156101f15783600001516001600160a01b031683828151811061056c5761056c610d9c565b60200260200101516001600160a01b03160361058b57505081516101f7565b600101610543565b600080826020015183600001516001600160601b03166105b39190610ee7565b60130b905060005b83604001515181101561062b57836040015181815181106105de576105de610d9c565b6020026020010151600001518460400151828151811061060057610600610d9c565b602002602001015160200151516106179190610f19565b6106219083610f49565b91506001016105bb565b5061063860011982610f71565b9392505050565b6000815180845260005b8181101561066557602081850181015186830182015201610649565b506000602082860101526020601f19601f83011685010191505092915050565b602081526000610638602083018461063f565b634e487b7160e01b600052604160045260246000fd5b604051602081016001600160401b03811182821017156106d0576106d0610698565b60405290565b60405160c081016001600160401b03811182821017156106d0576106d0610698565b604051601f8201601f191681016001600160401b038111828210171561072057610720610698565b604052919050565b60006001600160401b0382111561074157610741610698565b5060051b60200190565b6000806040838503121561075e57600080fd5b82356001600160401b0381111561077457600080fd5b8301601f8101851361078557600080fd5b8035602061079a61079583610728565b6106f8565b82815260059290921b830181019181810190888411156107b957600080fd5b938201935b838510156107f15782858a0312156107d65760008081fd5b6107de6106ae565b85358152825293820193908201906107be565b98969091013596505050505050565b6000806040838503121561081357600080fd5b50508035926020909101359150565b805182526000602082015160606020850152610841606085018261063f565b604093840151949093019390935250919050565b60008151808452602080850194506020840160005b838110156108865781518752958201959082019060010161086a565b509495945050505050565b602080825282516001600160601b031682820152828101516001600160a01b031660408084019190915283015160c06060840152805160e0840181905260009291610100600583901b86018101929184019190860190855b818110156109175760ff19888603018352610905858551610822565b945092850192918501916001016108e9565b5050505060608501519150601f1980858303016080860152610939828461063f565b925060808601519150808584030160a08601526109568383610855565b925060a08601519150808584030160c0860152506109748282610822565b95945050505050565b6020815281516020820152600060208301516040808401526109a2606084018261063f565b949350505050565b6001600160a01b03811681146109bf57600080fd5b50565b60008082840360408112156109d657600080fd5b6020808212156109e557600080fd5b6109ed6106ae565b915084356109fa816109aa565b825290925083810135906001600160401b03821115610a1857600080fd5b818501915085601f830112610a2c57600080fd5b8135610a3a61079582610728565b81815260059190911b83018201908281019088831115610a5957600080fd5b938301935b82851015610a80578435610a71816109aa565b82529383019390830190610a5e565b80955050505050509250929050565b80356001600160601b0381168114610aa657600080fd5b919050565b8035610aa6816109aa565b60006001600160401b03831115610acf57610acf610698565b610ae2601f8401601f19166020016106f8565b9050828152838383011115610af657600080fd5b828260208301376000602084830101529392505050565b600060608284031215610b1f57600080fd5b604051606081016001600160401b038282108183111715610b4257610b42610698565b81604052829350843583526020850135915080821115610b6157600080fd5b508301601f81018513610b7357600080fd5b610b8285823560208401610ab6565b602083015250604083013560408201525092915050565b600082601f830112610baa57600080fd5b81356020610bba61079583610728565b82815260059290921b84018101918181019086841115610bd957600080fd5b8286015b84811015610c185780356001600160401b03811115610bfc5760008081fd5b610c0a8986838b0101610b0d565b845250918301918301610bdd565b509695505050505050565b600082601f830112610c3457600080fd5b61063883833560208501610ab6565b600082601f830112610c5457600080fd5b81356020610c6461079583610728565b8083825260208201915060208460051b870101935086841115610c8657600080fd5b602086015b84811015610c185780358352918301918301610c8b565b600060208284031215610cb457600080fd5b81356001600160401b0380821115610ccb57600080fd5b9083019060c08286031215610cdf57600080fd5b610ce76106d6565b610cf083610a8f565b8152610cfe60208401610aab565b6020820152604083013582811115610d1557600080fd5b610d2187828601610b99565b604083015250606083013582811115610d3957600080fd5b610d4587828601610c23565b606083015250608083013582811115610d5d57600080fd5b610d6987828601610c43565b60808301525060a083013582811115610d8157600080fd5b610d8d87828601610b0d565b60a08301525095945050505050565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b6000600160ff1b8201610ddd57610ddd610db2565b5060000390565b600181815b80851115610e1f578160001904821115610e0557610e05610db2565b80851615610e1257918102915b93841c9390800290610de9565b509250929050565b600082610e36575060016101f7565b81610e43575060006101f7565b8160018114610e595760028114610e6357610e7f565b60019150506101f7565b60ff841115610e7457610e74610db2565b50506001821b6101f7565b5060208310610133831016604e8410600b8410161715610ea2575081810a6101f7565b610eac8383610de4565b8060001904821115610ec057610ec0610db2565b029392505050565b60006106388383610e27565b818103818111156101f7576101f7610db2565b6001600160a01b03828116828216818102831692918115828504821417610f1057610f10610db2565b50505092915050565b80820260008212600160ff1b84141615610f3557610f35610db2565b81810583148215176101f7576101f7610db2565b8082018281126000831280158216821582161715610f6957610f69610db2565b505092915050565b600082610f8e57634e487b7160e01b600052601260045260246000fd5b600160ff1b821460001984141615610fa857610fa8610db2565b50059056fea264697066735822122070b4e453579dddf0a61d86af981f2027624975b823d2a690cb3bc837d522e76664736f6c63430008180033"

    static let JustANameError = ABI.Function(
        name: "JustAName",
        inputs: []
    )

    static let JustOneArgError = ABI.Function(
        name: "JustOneArg",
        inputs: [.bool]
    )

    enum RevertReason: Equatable, Error {
        case justAName
        case justOneArg(Bool)
        case unknownRevert(String, String)
    }

    static func rewrapError(_ error: ABI.Function, value: ABI.Value) -> RevertReason {
        switch (error, value) {
        case (JustANameError, _):
            return .justAName
        case (JustOneArgError, let .tuple1(.bool(var0))):
            return .justOneArg(var0)
        case let (e, v):
            return .unknownRevert(e.name, String(describing: v))
        }
    }

    static let errors: [ABI.Function] = [JustANameError, JustOneArgError]
    static let acceptBatFn = ABI.Function(
        name: "acceptBat",
        inputs: [.tuple([.uint96, .uint160, .array(Cat.schema), .string, .array(.uint256), Cat.schema])],
        outputs: [.int256]
    )

    static func acceptBat(bat: Bat) throws -> Result<BigInt, RevertReason> {
        do {
            let query = try acceptBatFn.encoded(with: [bat.asValue])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try acceptBatFn.decode(output: result)

            switch decoded {
            case let .tuple1(.int256(var0)):
                return .success(var0)
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, acceptBatFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }

    static let anotherEmptyGooseFn = ABI.Function(
        name: "anotherEmptyGoose",
        inputs: [],
        outputs: [.bytes]
    )

    static func anotherEmptyGoose() throws -> Result<Hex, RevertReason> {
        do {
            let query = try anotherEmptyGooseFn.encoded(with: [])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try anotherEmptyGooseFn.decode(output: result)

            switch decoded {
            case let .tuple1(.bytes(var0)):
                return .success(var0)
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, anotherEmptyGooseFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }

    static let buildBatFn = ABI.Function(
        name: "buildBat",
        inputs: [.uint256, .uint256],
        outputs: [.tuple([.uint96, .uint160, .array(Cat.schema), .string, .array(.uint256), Cat.schema])]
    )

    static func buildBat(x: BigUInt, y: BigUInt) throws -> Result<Bat, RevertReason> {
        do {
            let query = try buildBatFn.encoded(with: [.uint256(x), .uint256(y)])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try buildBatFn.decode(output: result)

            switch decoded {
            case let .tuple1(.tuple6(.uint96(a),
                                     .uint160(b),
                                     .array(Cat.schema, c),
                                     .string(d),
                                     .array(.uint256, e),
                                     f)):
                return try .success(Bat(a: a, b: b, c: c.map {
                    try Cat.decodeValue($0)
                }, d: d, e: e.map {
                    $0.asBigUInt!
                }, f: Cat.decodeValue(f)))
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, buildBatFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }

    static let emptyGooseFn = ABI.Function(
        name: "emptyGoose",
        inputs: [],
        outputs: [.tuple([.uint256, .string])]
    )

    static func emptyGoose() throws -> Result<Animal.Goose, RevertReason> {
        do {
            let query = try emptyGooseFn.encoded(with: [])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try emptyGooseFn.decode(output: result)

            switch decoded {
            case let .tuple1(.tuple2(.uint256(b),
                                     .string(c))):
                return .success(Animal.Goose(b: b, c: c))
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, emptyGooseFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }

    static let lookAtMooseFn = ABI.Function(
        name: "lookAtMoose",
        inputs: [.array(.tuple([.uint256])), .uint256],
        outputs: [.bool]
    )

    static func lookAtMoose(moose: [Animal.Moose], m: BigUInt) throws -> Result<Bool, RevertReason> {
        do {
            let query = try lookAtMooseFn.encoded(with: [.array(Animal.Moose.schema, moose.map {
                $0.asValue
            }), .uint256(m)])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try lookAtMooseFn.decode(output: result)

            switch decoded {
            case let .tuple1(.bool(var0)):
                return .success(var0)
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, lookAtMooseFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }

    static let lookAtRatFn = ABI.Function(
        name: "lookAtRat",
        inputs: [.tuple([.address]), .array(.address)],
        outputs: [.address]
    )

    static func lookAtRat(rat: Animal.Rat, holes: [EthAddress]) throws -> Result<EthAddress, RevertReason> {
        do {
            let query = try lookAtRatFn.encoded(with: [rat.asValue, .array(.address, holes.map {
                .address($0)
            })])
            let result = try EVM.runQuery(bytecode: runtimeCode, query: query, withErrors: errors)
            let decoded = try lookAtRatFn.decode(output: result)

            switch decoded {
            case let .tuple1(.address(var0)):
                return .success(var0)
            default:
                throw ABI.DecodeError.mismatchedType(decoded.schema, lookAtRatFn.outputTuple)
            }
        } catch let EVM.QueryError.error(e, v) {
            return .failure(rewrapError(e, value: v))
        }
    }
}
